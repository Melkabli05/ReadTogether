import{a as B,b as j}from"./chunk-FUABNP4M.js";import{A as M,a as H,f as F,h as P,j as z,z as A}from"./chunk-LIH7W3MM.js";import{c as O,d as $}from"./chunk-ALJ5RMWQ.js";import{Db as u,Na as r,Sb as s,Tb as C,U as v,Ub as _,Ya as U,cc as D,da as b,ha as w,ic as T,kc as k,lb as I,nb as g,ob as y,pb as E,qb as S,qc as c,rb as R,rc as N,sb as x,tb as o,ub as d,uc as L,vb as h}from"./chunk-OGDA6C4E.js";import{a as p,b as f}from"./chunk-ODN5LVDJ.js";var q=t=>({"ring-2 ring-green-300 shadow-green-100":t}),J=(t,n)=>n.id;function G(t,n){if(t&1&&h(0,"img",3),t&2){let i,e,a=u();x("ngSrc",a.getOptimizedImageUrl(((i=a.hostUser())==null?null:i.profilePictureUrl)??"",40,40))("alt",((e=a.hostUser())==null?null:e.displayName)??"Host")}}function K(t,n){if(t&1&&(o(0,"span",4),s(1),d()),t&2){let i,e,a=u();x("title",((i=a.hostUser())==null?null:i.displayName)??"Host"),r(),_(" ",((e=a.hostUser())==null||e.displayName==null?null:e.displayName.charAt(0))??"U"," ")}}function Q(t,n){if(t&1&&h(0,"img",22),t&2){let i,e,a=u(2);x("ngSrc",a.getOptimizedImageUrl(((i=a.resolvedCurrentReader())==null?null:i.profilePictureUrl)??"",32,32))("alt",((e=a.resolvedCurrentReader())==null?null:e.displayName)??"Current Reader")}}function X(t,n){t&1&&(o(0,"span",25),s(1,"(Host)"),d())}function Y(t,n){if(t&1&&(o(0,"div",10),g(1,Q,1,2,"img",22),o(2,"span",23),s(3),d(),h(4,"i",24),g(5,X,2,0,"span",25),d()),t&2){let i,e,a=u();r(),y((i=a.resolvedCurrentReader())!=null&&i.profilePictureUrl?1:-1),r(2),C(((e=a.resolvedCurrentReader())==null?null:e.displayName)??"Unknown"),r(2),y(a.isHostCurrentReader()?5:-1)}}function Z(t,n){if(t&1&&(o(0,"div",11),h(1,"i",26),o(2,"span",27),s(3),T(4,"date"),d()()),t&2){let i=u();r(3),_("Starts at ",k(4,1,i.room().scheduledTime,"shortTime"))}}function ee(t,n){if(t&1&&h(0,"img",28),t&2){let i=u().$implicit,e=u();x("ngSrc",e.getOptimizedImageUrl(i.profilePictureUrl,24,24))("alt",i.displayName)("title",i.displayName)}}function te(t,n){if(t&1&&(o(0,"span",29),s(1),d()),t&2){let i=u().$implicit;x("title",i.displayName),r(),_(" ",i.displayName?i.displayName.charAt(0):i.username?i.username.charAt(0):"?"," ")}}function ie(t,n){if(t&1&&g(0,ee,1,3,"img",28)(1,te,2,2,"span",29),t&2){let i=n.$implicit;y(i.profilePictureUrl?0:1)}}function ne(t,n){if(t&1&&(o(0,"span",30),s(1),d()),t&2){let i=n.$implicit;r(),_(" ",i," ")}}function re(t,n){if(t&1&&(o(0,"div",20),S(1,ne,2,1,"span",30,E),d()),t&2){let i=u();r(),R(i.room().tags)}}var V=class t{room=L.required();RoomStatus=O;userService=v($);roomService=v(B);textService=v(j);imageService=v(A);destroyRef=v(b);_cardData=w({hosts:[],textContent:void 0,currentReader:void 0});resolvedHosts=c(()=>this._cardData().hosts);resolvedTextContent=c(()=>this._cardData().textContent);resolvedCurrentReader=c(()=>this._cardData().currentReader);hostUser=c(()=>this.resolvedHosts()[0]);isHostCurrentReader=c(()=>this.room().currentReaderId===this.hostUser()?.id);statusLabel=c(()=>oe(this.room().status));statusBadgeClass=c(()=>({"bg-green-100 text-green-700":this.room().status==="live","bg-yellow-100 text-yellow-700":this.room().status==="scheduled","bg-gray-100 text-gray-600":this.room().status==="ended","bg-red-100 text-red-700":this.room().status==="cancelled"}));actionLabel=c(()=>ae(this.room().status));actionIcon=c(()=>{let n=this.room().status;return n==="live"?"pi pi-microphone":n==="scheduled"?"pi pi-sign-in":null});actionSeverity=c(()=>{let n=this.room().status;return n==="live"||n==="scheduled"?"primary":"secondary"});isOutlined=c(()=>this.room().status!=="live");constructor(){this.setupEffects()}getOptimizedImageUrl(n,i,e){return this.imageService.optimizeImageUrl(n,{width:i,height:e})}setupEffects(){N(()=>{let n=this.room(),i=n.id,e=n.textContentId,a=n.currentReaderId;this.roomService.getRoomHosts(i).then(l=>{let m=l.map(W=>W.userId);return this.userService.getUsersByIds(m)}).then(l=>{this._cardData.update(m=>f(p({},m),{hosts:l}))}).catch(l=>{console.error("Failed to fetch room hosts:",l),this._cardData.update(m=>f(p({},m),{hosts:[]}))}),e?this.textService.getTextContentTitle(e).then(l=>{this._cardData.update(m=>f(p({},m),{textContent:l??void 0}))}).catch(l=>{console.error("Failed to fetch text content:",l),this._cardData.update(m=>f(p({},m),{textContent:void 0}))}):this._cardData.update(l=>f(p({},l),{textContent:void 0})),a?this.userService.getUser(a).then(l=>{this._cardData.update(m=>f(p({},m),{currentReader:l??void 0}))}).catch(l=>{console.error("Failed to fetch current reader:",l),this._cardData.update(m=>f(p({},m),{currentReader:void 0}))}):this._cardData.update(l=>f(p({},l),{currentReader:void 0}))})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=U({type:t,selectors:[["app-room-card"]],inputs:{room:[1,"room"]},decls:34,vars:22,consts:[["tabindex","0","role","article",1,"rounded-2xl","p-4","sm:p-5","bg-white","shadow-md","border","border-gray-100","transition-all","duration-200","hover:shadow-lg","cursor-pointer","flex","flex-col","gap-3","w-full","min-h-[27rem]","h-[27rem]",3,"ngClass"],[1,"flex","justify-between","items-start"],[1,"flex","items-center","gap-3","min-w-0","flex-1"],["width","40","height","40","priority","low",1,"w-10","h-10","rounded-full","border","border-gray-200","shadow-sm","flex-shrink-0",3,"ngSrc","alt"],[1,"w-10","h-10","flex","items-center","justify-center","rounded-full","bg-gray-300","text-gray-600","border","border-gray-200","text-lg","font-bold","flex-shrink-0",3,"title"],[1,"min-w-0","flex-1"],[1,"text-base","font-semibold","text-gray-800","truncate"],[1,"text-xs","text-gray-500","truncate"],[1,"text-xs","px-2","py-0.5","rounded-full","font-medium","flex-shrink-0","ml-2",3,"ngClass"],[1,"text-sm","text-gray-600","line-clamp-2","min-h-[2rem]","flex-shrink-0"],[1,"flex","items-center","gap-2","bg-green-50","border","border-green-200","rounded-lg","p-2","flex-shrink-0"],[1,"flex","items-center","gap-2","bg-yellow-50","border","border-yellow-200","rounded-lg","p-2","flex-shrink-0"],[1,"flex","flex-wrap","gap-2","mt-1","text-xs","text-gray-700","flex-shrink-0"],[1,"flex","items-center","gap-1"],[1,"pi","pi-users"],[1,"pi","pi-globe"],[1,"text-sm","text-gray-800","flex-shrink-0"],[1,"font-medium"],[1,"truncate"],[1,"flex","items-center","-space-x-3","mt-2","flex-shrink-0"],[1,"flex","flex-wrap","gap-1","mt-2","flex-shrink-0"],[1,"mt-auto",3,"label","icon","severity","outlined","size","fullWidth"],["width","32","height","32","priority","low",1,"w-6","h-6","sm:w-8","sm:h-8","rounded-full","border-white","shadow-sm","flex-shrink-0",3,"ngSrc","alt"],[1,"text-green-700","font-medium","text-sm","truncate"],[1,"pi","pi-microphone","text-green-700","text-sm","flex-shrink-0"],[1,"text-xs","text-green-600","ml-1","flex-shrink-0"],[1,"pi","pi-clock","text-yellow-700","flex-shrink-0"],[1,"text-sm","text-yellow-800"],["width","24","height","24","priority","low",1,"w-6","h-6","rounded-full","border-2","border-white","shadow-sm",3,"ngSrc","alt","title"],[1,"w-6","h-6","flex","items-center","justify-center","rounded-full","bg-gray-300","text-gray-600","border-2","border-white","text-xs","font-bold",3,"title"],[1,"px-2","py-0.5","rounded","bg-blue-100","text-blue-700","text-xs","font-medium"]],template:function(i,e){if(i&1&&(o(0,"article",0)(1,"div",1)(2,"div",2),g(3,G,1,2,"img",3)(4,K,2,2,"span",4),o(5,"div",5)(6,"h3",6),s(7),d(),o(8,"p",7),s(9),d()()(),o(10,"span",8),s(11),d()(),o(12,"p",9),s(13),d(),g(14,Y,6,3,"div",10),g(15,Z,5,4,"div",11),o(16,"div",12)(17,"div",13),h(18,"i",14),s(19),d(),o(20,"div",13),h(21,"i",15),o(22,"span"),s(23),d()()(),o(24,"div",16)(25,"span",17),s(26,"Text:"),d(),o(27,"span",18),s(28),d()(),o(29,"div",19),S(30,ie,2,1,null,null,J),d(),g(32,re,3,0,"div",20),h(33,"app-button",21),d()),i&2){let a,l;x("ngClass",D(20,q,e.room().status===e.RoomStatus.Live)),I("aria-label","Room: "+e.room().title),r(3),y((a=e.hostUser())!=null&&a.profilePictureUrl?3:4),r(4),C(e.room().title),r(2),_("Host: ",((l=e.hostUser())==null?null:l.displayName)??"Unknown"),r(),x("ngClass",e.statusBadgeClass()),r(),_(" ",e.statusLabel()," "),r(2),C(e.room().description),r(),y(e.room().status===e.RoomStatus.Live&&e.resolvedCurrentReader()?14:-1),r(),y(e.room().status===e.RoomStatus.Scheduled?15:-1),r(4),_(" ",e.room().audienceCount," audience "),r(4),C(e.room().language),r(5),C(e.resolvedTextContent()||"Unknown"),r(2),R(e.resolvedHosts()),r(2),y(e.room().tags.length>0?32:-1),r(),x("label",e.actionLabel())("icon",e.actionIcon())("severity",e.actionSeverity())("outlined",e.isOutlined())("size","sm")("fullWidth",!0)}},dependencies:[P,H,F,z,M],encapsulation:2,changeDetection:0})};function oe(t){switch(t){case"live":return"Live";case"scheduled":return"Upcoming";case"ended":return"Ended";case"cancelled":return"Cancelled";default:return""}}function ae(t){switch(t){case"live":return"Join Room";case"scheduled":return"RSVP";case"ended":return"View Recap";default:return"View"}}export{V as a};
