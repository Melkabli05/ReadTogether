import{a as U}from"./chunk-7ZPMTGN7.js";import{a as W,b as G}from"./chunk-JWPCJFGN.js";import{A as Q,a as j,f as A,h as M,j as V,z as K}from"./chunk-HUPU4MDU.js";import{i as q,j as J}from"./chunk-L6GAGA3Z.js";import{Db as c,I,J as D,Na as r,Sb as d,Tb as S,U as C,Ub as g,Ya as N,cc as P,da as L,ha as k,i as R,ic as z,j as b,kc as B,lb as H,nb as u,ob as p,pb as F,qb as E,qc as m,rb as T,rc as O,sb as f,tb as o,ub as a,uc as $,vb as x,x as w}from"./chunk-YG2LBRBX.js";import{a as _,b as v}from"./chunk-ODN5LVDJ.js";var Z=e=>({"ring-2 ring-green-300 shadow-green-100":e}),ee=(e,n)=>n.id;function te(e,n){if(e&1&&x(0,"img",3),e&2){let i,t,l=c();f("ngSrc",l.getOptimizedImageUrl(((i=l.hostUser())==null?null:i.profilePictureUrl)??"",40,40))("alt",((t=l.hostUser())==null?null:t.displayName)??"Host")}}function ie(e,n){if(e&1&&(o(0,"span",4),d(1),a()),e&2){let i,t,l=c();f("title",((i=l.hostUser())==null?null:i.displayName)??"Host"),r(),g(" ",((t=l.hostUser())==null||t.displayName==null?null:t.displayName.charAt(0))??"U"," ")}}function ne(e,n){if(e&1&&x(0,"img",23),e&2){let i,t,l=c(2);f("ngSrc",l.getOptimizedImageUrl(((i=l.resolvedCurrentReader())==null?null:i.profilePictureUrl)??"",32,32))("alt",((t=l.resolvedCurrentReader())==null?null:t.displayName)??"Current Reader")}}function re(e,n){e&1&&(o(0,"span",26),d(1,"(Host)"),a())}function oe(e,n){if(e&1&&(o(0,"div",10),u(1,ne,1,2,"img",23),o(2,"span",24),d(3),a(),x(4,"i",25),u(5,re,2,0,"span",26),a()),e&2){let i,t,l=c();r(),p((i=l.resolvedCurrentReader())!=null&&i.profilePictureUrl?1:-1),r(2),S(((t=l.resolvedCurrentReader())==null?null:t.displayName)??"Unknown"),r(2),p(l.isHostCurrentReader()?5:-1)}}function ae(e,n){if(e&1&&(o(0,"div",11),x(1,"i",27),o(2,"span",28),d(3),z(4,"date"),a()()),e&2){let i=c();r(3),g("Starts at ",B(4,1,i.room().scheduledTime,"shortTime"))}}function le(e,n){e&1&&(o(0,"span",18),d(1,"Loading..."),a())}function se(e,n){if(e&1&&(o(0,"span",19),d(1),a()),e&2){let i=c();r(),S(i.resolvedTextContent()||"Unknown")}}function de(e,n){if(e&1&&x(0,"img",29),e&2){let i=c().$implicit,t=c();f("ngSrc",t.getOptimizedImageUrl(i.profilePictureUrl,24,24))("alt",i.displayName)("title",i.displayName)}}function me(e,n){if(e&1&&(o(0,"span",30),d(1),a()),e&2){let i=c().$implicit;f("title",i.displayName),r(),g(" ",i.displayName?i.displayName.charAt(0):i.username?i.username.charAt(0):"?"," ")}}function ce(e,n){if(e&1&&u(0,de,1,3,"img",29)(1,me,2,2,"span",30),e&2){let i=n.$implicit;p(i.profilePictureUrl?0:1)}}function ue(e,n){if(e&1&&(o(0,"span",31),d(1),a()),e&2){let i=n.$implicit;r(),g(" ",i," ")}}function pe(e,n){if(e&1&&(o(0,"div",21),E(1,ue,2,1,"span",31,F),a()),e&2){let i=c();r(),T(i.room().tags)}}var X=class e{room=$.required();RoomStatus=q;userService=C(J);roomService=C(W);textService=C(G);imageService=C(K);destroyRef=C(L);_cardData=k({hosts:[],textContent:void 0,currentReader:void 0,isLoading:!1});cardData=this._cardData.asReadonly();resolvedHosts=m(()=>this._cardData().hosts);resolvedTextContent=m(()=>this._cardData().textContent);resolvedCurrentReader=m(()=>this._cardData().currentReader);hostUser=m(()=>{let n=this.room().hosts;return n&&n.length>0?n[0]:this.resolvedHosts()[0]});isHostCurrentReader=m(()=>this.room().currentReaderId===this.hostUser()?.id);statusLabel=m(()=>fe(this.room().status));statusBadgeClass=m(()=>({"bg-green-100 text-green-700":this.room().status==="live","bg-yellow-100 text-yellow-700":this.room().status==="scheduled","bg-gray-100 text-gray-600":this.room().status==="ended","bg-red-100 text-red-700":this.room().status==="cancelled"}));actionLabel=m(()=>xe(this.room().status));actionIcon=m(()=>{let n=this.room().status;return n==="live"?"pi pi-microphone":n==="scheduled"?"pi pi-sign-in":null});actionSeverity=m(()=>{let n=this.room().status;return n==="live"||n==="scheduled"?"primary":"secondary"});isOutlined=m(()=>this.room().status!=="live");constructor(){this.setupEffects()}getOptimizedImageUrl(n,i,t){return this.imageService.optimizeImageUrl(n,{width:i,height:t})}setupEffects(){O(()=>{let n=this.room(),i=n.id,t=n.textContentId,l=n.currentReaderId;this._cardData.update(s=>v(_({},s),{isLoading:!0}));let y=n.hosts;y&&y.length>0?this._cardData.update(s=>v(_({},s),{hosts:y,isLoading:!1})):R(this.roomService.getRoomHosts(i)).pipe(U(this.destroyRef),D(s=>{let h=s.map(Y=>Y.userId);return R(this.userService.getUsersByIds(h))}),w(s=>(console.error("Failed to fetch room hosts:",s),b([])))).subscribe(s=>{this._cardData.update(h=>v(_({},h),{hosts:s,isLoading:!1}))}),t&&R(this.textService.getTextContentTitle(t)).pipe(U(this.destroyRef),I(void 0),w(s=>(console.error("Failed to fetch text content:",s),b(void 0)))).subscribe(s=>{this._cardData.update(h=>v(_({},h),{textContent:s??void 0}))}),l&&R(this.userService.getUser(l)).pipe(U(this.destroyRef),I(void 0),w(s=>(console.error("Failed to fetch current reader:",s),b(void 0)))).subscribe(s=>{this._cardData.update(h=>v(_({},h),{currentReader:s??void 0}))})})}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=N({type:e,selectors:[["app-room-card"]],inputs:{room:[1,"room"]},decls:34,vars:22,consts:[["tabindex","0","role","article",1,"rounded-2xl","p-4","sm:p-5","bg-white","shadow-md","border","border-gray-100","transition-all","duration-200","hover:shadow-lg","cursor-pointer","flex","flex-col","gap-3","w-full","min-h-[27rem]","h-[27rem]",3,"ngClass"],[1,"flex","justify-between","items-start"],[1,"flex","items-center","gap-3","min-w-0","flex-1"],["width","40","height","40","priority","low",1,"w-10","h-10","rounded-full","border","border-gray-200","shadow-sm","flex-shrink-0",3,"ngSrc","alt"],[1,"w-10","h-10","flex","items-center","justify-center","rounded-full","bg-gray-300","text-gray-600","border","border-gray-200","text-lg","font-bold","flex-shrink-0",3,"title"],[1,"min-w-0","flex-1"],[1,"text-base","font-semibold","text-gray-800","truncate"],[1,"text-xs","text-gray-500","truncate"],[1,"text-xs","px-2","py-0.5","rounded-full","font-medium","flex-shrink-0","ml-2",3,"ngClass"],[1,"text-sm","text-gray-600","line-clamp-2","min-h-[2rem]","flex-shrink-0"],[1,"flex","items-center","gap-2","bg-green-50","border","border-green-200","rounded-lg","p-2","flex-shrink-0"],[1,"flex","items-center","gap-2","bg-yellow-50","border","border-yellow-200","rounded-lg","p-2","flex-shrink-0"],[1,"flex","flex-wrap","gap-2","mt-1","text-xs","text-gray-700","flex-shrink-0"],[1,"flex","items-center","gap-1"],[1,"pi","pi-users"],[1,"pi","pi-globe"],[1,"text-sm","text-gray-800","flex-shrink-0"],[1,"font-medium"],[1,"text-gray-400"],[1,"truncate"],[1,"flex","items-center","-space-x-3","mt-2","flex-shrink-0"],[1,"flex","flex-wrap","gap-1","mt-2","flex-shrink-0"],[1,"mt-auto",3,"label","icon","severity","outlined","size","fullWidth"],["width","32","height","32","priority","low",1,"w-6","h-6","sm:w-8","sm:h-8","rounded-full","border-white","shadow-sm","flex-shrink-0",3,"ngSrc","alt"],[1,"text-green-700","font-medium","text-sm","truncate"],[1,"pi","pi-microphone","text-green-700","text-sm","flex-shrink-0"],[1,"text-xs","text-green-600","ml-1","flex-shrink-0"],[1,"pi","pi-clock","text-yellow-700","flex-shrink-0"],[1,"text-sm","text-yellow-800"],["width","24","height","24","priority","low",1,"w-6","h-6","rounded-full","border-2","border-white","shadow-sm",3,"ngSrc","alt","title"],[1,"w-6","h-6","flex","items-center","justify-center","rounded-full","bg-gray-300","text-gray-600","border-2","border-white","text-xs","font-bold",3,"title"],[1,"px-2","py-0.5","rounded","bg-blue-100","text-blue-700","text-xs","font-medium"]],template:function(i,t){if(i&1&&(o(0,"article",0)(1,"div",1)(2,"div",2),u(3,te,1,2,"img",3)(4,ie,2,2,"span",4),o(5,"div",5)(6,"h3",6),d(7),a(),o(8,"p",7),d(9),a()()(),o(10,"span",8),d(11),a()(),o(12,"p",9),d(13),a(),u(14,oe,6,3,"div",10),u(15,ae,5,4,"div",11),o(16,"div",12)(17,"div",13),x(18,"i",14),d(19),a(),o(20,"div",13),x(21,"i",15),o(22,"span"),d(23),a()()(),o(24,"div",16)(25,"span",17),d(26,"Text:"),a(),u(27,le,2,0,"span",18)(28,se,2,1,"span",19),a(),o(29,"div",20),E(30,ce,2,1,null,null,ee),a(),u(32,pe,3,0,"div",21),x(33,"app-button",22),a()),i&2){let l,y;f("ngClass",P(20,Z,t.room().status===t.RoomStatus.Live)),H("aria-label","Room: "+t.room().title),r(3),p((l=t.hostUser())!=null&&l.profilePictureUrl?3:4),r(4),S(t.room().title),r(2),g("Host: ",((y=t.hostUser())==null?null:y.displayName)??"Unknown"),r(),f("ngClass",t.statusBadgeClass()),r(),g(" ",t.statusLabel()," "),r(2),S(t.room().description),r(),p(t.room().status===t.RoomStatus.Live&&t.resolvedCurrentReader()?14:-1),r(),p(t.room().status===t.RoomStatus.Scheduled?15:-1),r(4),g(" ",t.room().audienceCount," audience "),r(4),S(t.room().language),r(4),p(t.cardData().isLoading?27:28),r(3),T(t.resolvedHosts()),r(2),p(t.room().tags.length>0?32:-1),r(),f("label",t.actionLabel())("icon",t.actionIcon())("severity",t.actionSeverity())("outlined",t.isOutlined())("size","sm")("fullWidth",!0)}},dependencies:[M,j,A,V,Q],encapsulation:2,changeDetection:0})};function fe(e){switch(e){case"live":return"Live";case"scheduled":return"Upcoming";case"ended":return"Ended";case"cancelled":return"Cancelled";default:return""}}function xe(e){switch(e){case"live":return"Join Room";case"scheduled":return"RSVP";case"ended":return"View Recap";default:return"View"}}export{X as a};
